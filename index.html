<form id="request-form">
    <label for="name">Nom complet:</label>
    <input id="name" type="text" name="name" required>
    
    <label for="email">Votre email:</label>
    <input id="email" type="email" name="email" required>
    
    <label for="manager_email">Email du responsable:</label>
    <input id="manager_email" type="email" name="manager_email" required>
    
    <label for="start_date">Date de début:</label>
    <input id="start_date" type="date" name="start_date" required>
    
    <label for="end_date">Date de fin:</label>
    <input id="end_date" type="date" name="end_date" required>
    
    <label for="reason">Motif:</label>
    <textarea id="reason" name="reason" rows="4"></textarea>
    
    <button type="submit">Envoyer la demande</button>
</form>

<script>
    document.getElementById('request-form').addEventListener('submit', async (e) => {
        e.preventDefault();

        const submitButton = e.target.querySelector('button');
        submitButton.disabled = true; // Désactiver le bouton
        submitButton.textContent = 'Envoi en cours...';

        const formData = new FormData(e.target);
        const data = Object.fromEntries(formData.entries());

        // Validation des champs
        if (new Date(data.start_date) > new Date(data.end_date)) {
            alert('La date de début ne peut pas être postérieure à la date de fin.');
            submitButton.disabled = false;
            submitButton.textContent = 'Envoyer la demande';
            return;
        }

        try {
            const response = await fetch('/.netlify/functions/send-email', {
                method: 'POST',
                body: JSON.stringify(data),
                headers: { 'Content-Type': 'application/json' },
            });

            const result = await response.json();
            alert(result.message || result.error);
        } catch (error) {
            alert('Une erreur est survenue lors de l\'envoi. Veuillez réessayer.');
        } finally {
            submitButton.disabled = false;
            submitButton.textContent = 'Envoyer la demande'; // Réinitialiser le bouton
        }
    });
</script>
